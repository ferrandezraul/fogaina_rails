<% content_for :body do %>
  <%=raw @page.content_for(Refinery::Pages.default_parts.first[:slug].to_sym) unless params[:page] %>

  <% if @items.any? %>
    <%-# In order to display properly all breads,  -%>
    <%-# I need to add empty columns if the number -%>
    <%-# of breads is not a divisor of 3           -%>
    <% number_of_slices_of_three = (@items.count / 3.0) %>
    <% last_slice_of_three = number_of_slices_of_three.ceil %>
    <% last_index_slice_of_three = last_slice_of_three -1 %>

    <% extra_empty_rows = 0 %>
    <% if last_slice_of_three - number_of_slices_of_three == 0 %>
      <% extra_empty_rows = 0 %>
    <% elsif last_slice_of_three - number_of_slices_of_three > 0.5 %>
      <% extra_empty_rows = 2 %>
    <% elsif last_slice_of_three - number_of_slices_of_three < 0.5 %>
      <% extra_empty_rows = 1 %>
    <% end %> 

    <% @items.each_slice(3).with_index do |slice, slice_index| %>
      <div class="row">
        <% slice.each do |item| %>
          <div class="large-4 columns">
            <div class="news-item-wrapper">
              <div class="news-img-wrapper">
                <%= link_to "Read more", refinery.news_item_path(item), class: "button expand read-more" %>
                <% if item.photo %>
                  <%= image_tag item.photo.url %>
                <% else %>
                  <%= image_tag "logo_negro.svg" %>
                <% end %>
              </div>
              <h3><%= link_to item.title, refinery.news_item_path(item) %></h3>  
              <small><%= t('.published') %> <%= l(item.publish_date, :format => :short) %></small>
              <p>
                <%= truncate  item.body, :length => 200,
                              :omission => " ... #{link_to t('.read_more'), refinery.news_item_path(item)}",
                              :preserve_html_tags => true %>
              </p>
              
            </div>
          </div>
        <% end %>

        <%-# At the last slice, add empty columns if needed -%>
        <% if ( slice_index == last_index_slice_of_three ) && extra_empty_rows > 0 %>
          <% extra_empty_rows.times do %>
            <div class="large-4 columns">
            </div>
          <% end %>
        <% end %>

      </div>
    <% end %>

    <%= will_paginate @items %>
  <% else %>
    <p><em><%= t('.no_items_yet') %></em></p>
  <% end %>
<% end -%>

<% content_for :body_content_right_prepend do -%>
  <%= raw @page.content_for(::Refinery::Pages.default_parts.second[:slug].to_sym) %>
<% end if ::Refinery::Pages.default_parts.many? -%>
<%= render '/refinery/news/shared/body_content_right' %>

<%= render "/refinery/content_page" %>
